/**
 * jquery.Jcrop.js v0.9.12
 * jQuery Image Cropping Plugin - released under MIT License 
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */
(function(c){c.Jcrop=function(u,r){function m(a){return Math.round(a)+"px"}function A(a){a=c(a).offset();return[a.left,a.top]}function w(a){return[a.pageX-F[0],a.pageY-F[1]]}function B(a){"object"!==typeof a&&(a={});b=c.extend(b,a);c.each(["onChange","onSelect","onRelease","onDblClick"],function(a,o){"function"!==typeof b[o]&&(b[o]=function(){})})}function ta(a,b,o){F=A(i);y.setCursor("move"===a?a:a+"-resize");if("move"===a)return y.activateHandlers(gb(b),ia,o);var b=p.getFixed(),d=ua(a),c=p.getCorner(ua(d));
p.setPressed(p.getCorner(d));p.setCurrent(c);y.activateHandlers(hb(a,b),ia,o)}function hb(a,k){return function(o){if(b.aspectRatio)switch(a){case "e":o[1]=k.y+1;break;case "w":o[1]=k.y+1;break;case "n":o[0]=k.x+1;break;case "s":o[0]=k.x+1}else switch(a){case "e":o[1]=k.y2;break;case "w":o[1]=k.y2;break;case "n":o[0]=k.x2;break;case "s":o[0]=k.x2}p.setCurrent(o);g.update()}}function gb(a){var b=a;X.watchKeys();return function(a){p.moveOffset([a[0]-b[0],a[1]-b[1]]);b=a;g.update()}}function ua(a){switch(a){case "n":return"sw";
case "s":return"nw";case "e":return"nw";case "w":return"ne";case "ne":return"sw";case "nw":return"se";case "se":return"nw";case "sw":return"ne"}}function va(a){return function(k){if(b.disabled||"move"===a&&!b.allowMove)return!1;F=A(i);I=!0;ta(a,w(k));k.stopPropagation();k.preventDefault();return!1}}function wa(a,b,o){var d=a.width(),c=a.height();d>b&&0<b&&(d=b,c=b/a.width()*a.height());c>o&&0<o&&(c=o,d=o/a.height()*a.width());t=a.width()/d;v=a.height()/c;a.width(d).height(c)}function P(a){return{x:a.x*
t,y:a.y*v,x2:a.x2*t,y2:a.y2*v,w:a.w*t,h:a.h*v}}function ia(){var a=p.getFixed();a.w>b.minSelect[0]&&a.h>b.minSelect[1]?(g.enableHandles(),g.done()):g.release();y.setCursor(b.allowSelect?"crosshair":"default")}function xa(a){if(b.disabled||!b.allowSelect)return!1;I=!0;F=A(i);g.disableHandles();y.setCursor("crosshair");var k=w(a);p.setPressed(k);g.update();y.activateHandlers(ib,ia,"touch"===a.type.substring(0,5));X.watchKeys();a.stopPropagation();a.preventDefault();return!1}function ib(a){p.setCurrent(a);
g.update()}function ya(){var a=c("<div></div>").addClass(b.baseClass+"-tracker");za&&a.css({opacity:0,backgroundColor:"white"});return a}function Aa(a){Ba([a[0]/t,a[1]/v,a[2]/t,a[3]/v]);b.onSelect.call(z,P(p.getFixed()));g.enableHandles()}function Ba(a){p.setPressed([a[0],a[1]]);p.setCurrent([a[2],a[3]]);g.update()}function Ca(){b.disabled=!0;g.disableHandles();g.setCursor("default");y.setCursor("default")}function Da(){b.disabled=!1;ja()}function ka(a,k,o){k=k||b.bgColor;b.bgFade&&c.fx.step.hasOwnProperty("backgroundColor")&&
b.fadeTime&&!o?a.animate({backgroundColor:k},{queue:!1,duration:b.fadeTime}):a.css("backgroundColor",k)}function ja(a){b.allowResize?a?g.enableOnly():g.enableHandles():g.disableHandles();y.setCursor(b.allowSelect?"crosshair":"default");g.setCursor(b.allowMove?"move":"default");b.hasOwnProperty("trueSize")&&(t=b.trueSize[0]/n,v=b.trueSize[1]/l);b.hasOwnProperty("setSelect")&&(Aa(b.setSelect),g.done(),delete b.setSelect);C.refresh();b.bgColor!=Ea&&(ka(b.shade?C.getShades():D,b.shade?b.shadeColor||b.bgColor:
b.bgColor),Ea=b.bgColor);Q!=b.bgOpacity&&(Q=b.bgOpacity,b.shade?C.refresh():g.setBgOpacity(Q));R=b.maxSize[0]||0;S=b.maxSize[1]||0;T=b.minSize[0]||0;U=b.minSize[1]||0;b.hasOwnProperty("outerImage")&&(i.attr("src",b.outerImage),delete b.outerImage);g.refresh()}var b=c.extend({},c.Jcrop.defaults),F,Fa=navigator.userAgent.toLowerCase(),za=/msie/.test(Fa),Ga=/msie [1-6]\./.test(Fa);"object"!==typeof u&&(u=c(u)[0]);"object"!==typeof r&&(r={});B(r);var la={border:"none",visibility:"visible",margin:0,padding:0,
position:"absolute",top:0,left:0},s=c(u),Ha=!0;if("IMG"==u.tagName){if(0!=s[0].width&&0!=s[0].height)s.width(s[0].width),s.height(s[0].height);else{var ma=new Image;ma.src=s[0].src;s.width(ma.width);s.height(ma.height)}var i=s.clone().removeAttr("id").css(la).show();i.width(s.width());i.height(s.height());s.after(i).hide()}else i=s.css(la).show(),Ha=!1,null===b.shade&&(b.shade=!0);wa(i,b.boxWidth,b.boxHeight);var n=i.width(),l=i.height(),D=c("<div />").width(n).height(l).addClass(b.baseClass+"-holder").css({position:"relative",
backgroundColor:b.bgColor}).insertAfter(s).append(i);b.addClass&&D.addClass(b.addClass);var G=c("<div />"),Y=c("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),J=c("<div />").width("100%").height("100%").css("zIndex",320),K=c("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=p.getFixed();b.onDblClick.call(z,a)}).insertBefore(i).append(Y,J);Ha&&(G=c("<img />").attr("src",i.attr("src")).css(la).width(n).height(l),Y.append(G));Ga&&
K.css({overflowY:"hidden"});var L=b.boundary,H=ya().width(n+2*L).height(l+2*L).css({position:"absolute",top:m(-L),left:m(-L),zIndex:290}).mousedown(xa),Ea=b.bgColor,Q=b.bgOpacity,R,S,T,U,t,v,I,na,jb;F=A(i);var x,Ia=function(){var a={},b=["touchstart","touchmove","touchend"],o=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var c=b[d],c="on"+c,e=c in o;if(!e){o.setAttribute(c,"return;");e=typeof o[c]=="function"}a[b[d]]=e}return a.touchstart&&a.touchend&&a.touchmove}catch(f){return false}},
Ja;Ja=!0===b.touchSupport||!1===b.touchSupport?b.touchSupport:Ia();x={createDragger:function(a){return function(k){if(b.disabled||a==="move"&&!b.allowMove)return false;F=A(i);I=true;ta(a,w(x.cfilter(k)),true);k.stopPropagation();k.preventDefault();return false}},newSelection:function(a){return xa(x.cfilter(a))},cfilter:function(a){a.pageX=a.originalEvent.changedTouches[0].pageX;a.pageY=a.originalEvent.changedTouches[0].pageY;return a},isSupported:Ia,support:Ja};var p,La=function(){if(!b.aspectRatio){var a=
q-d,k=h-e;R&&Math.abs(a)>R&&(q=a>0?d+R:d-R);S&&Math.abs(k)>S&&(h=k>0?e+S:e-S);U/v&&Math.abs(k)<U/v&&(h=k>0?e+U/v:e-U/v);T/t&&Math.abs(a)<T/t&&(q=a>0?d+T/t:d-T/t);if(d<0){q=q-d;d=d-d}if(e<0){h=h-e;e=e-e}if(q<0){d=d-q;q=q-q}if(h<0){e=e-h;h=h-h}if(q>n){a=q-n;d=d-a;q=q-a}if(h>l){a=h-l;e=e-a;h=h-a}if(d>n){a=d-l;h=h-a;e=e-a}if(e>l){a=e-l;h=h-a;e=e-a}return Ka(oa(d,e,q,h))}var a=b.aspectRatio,k=b.minSize[0]/t,c=b.maxSize[0]/t,g=q-d,i=h-e,j=Math.abs(g),f=Math.abs(i);c===0&&(c=n*10);if(j/f<a){j=h;f=f*a;f=
g<0?d-f:f+d;if(f<0){f=0;j=Math.abs((f-d)/a);j=i<0?e-j:j+e}else if(f>n){f=n;j=Math.abs((f-d)/a);j=i<0?e-j:j+e}}else{f=q;j=j/a;j=i<0?e-j:e+j;if(j<0){j=0;f=Math.abs((j-e)*a);f=g<0?d-f:f+d}else if(j>l){j=l;f=Math.abs(j-e)*a;f=g<0?d-f:f+d}}if(f>d){f-d<k?f=d+k:f-d>c&&(f=d+c);j=j>e?e+(f-d)/a:e-(f-d)/a}else if(f<d){d-f<k?f=d-k:d-f>c&&(f=d-c);j=j>e?e+(d-f)/a:e-(d-f)/a}if(f<0){d=d-f;f=0}else if(f>n){d=d-(f-n);f=n}if(j<0){e=e-j;j=0}else if(j>l){e=e-(j-l);j=l}return Ka(oa(d,e,f,j))},Ma=function(a){a[0]<0&&(a[0]=
0);a[1]<0&&(a[1]=0);a[0]>n&&(a[0]=n);a[1]>l&&(a[1]=l);return[Math.round(a[0]),Math.round(a[1])]},oa=function(a,b,c,d){var e=a,g=c,f=b,i=d;if(c<a){e=c;g=a}if(d<b){f=d;i=b}return[e,f,g,i]},Ka=function(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}},d=0,e=0,q=0,h=0,Na,Oa;p={flipCoords:oa,setPressed:function(a){a=Ma(a);q=d=a[0];h=e=a[1]},setCurrent:function(a){a=Ma(a);Na=a[0]-q;Oa=a[1]-h;q=a[0];h=a[1]},getOffset:function(){return[Na,Oa]},moveOffset:function(a){var b=a[0],a=a[1];0>d+
b&&(b=b-(b+d));0>e+a&&(a=a-(a+e));l<h+a&&(a=a+(l-(h+a)));n<q+b&&(b=b+(n-(q+b)));d=d+b;q=q+b;e=e+a;h=h+a},getCorner:function(a){var b=La();switch(a){case "ne":return[b.x2,b.y];case "nw":return[b.x,b.y];case "se":return[b.x2,b.y2];case "sw":return[b.x,b.y2]}},getFixed:La};var C,Qa=function(){return Pa(p.getFixed())},Pa=function(a){M.top.css({left:m(a.x),width:m(a.w),height:m(a.y)});M.bottom.css({top:m(a.y2),left:m(a.x),width:m(a.w),height:m(l-a.y2)});M.right.css({left:m(a.x2),width:m(n-a.x2)});M.left.css({width:m(a.x)})},
Z=function(){return c("<div />").css({position:"absolute",backgroundColor:b.shadeColor||b.bgColor}).appendTo(N)},Sa=function(){if(!V){V=true;N.insertBefore(i);Qa();g.setBgOpacity(1,0,1);G.hide();Ra(b.shadeColor||b.bgColor,1);g.isAwake()?$(b.bgOpacity,1):$(1,1)}},Ra=function(a,b){ka(Ta(),a,b)},Ua=function(){if(V){N.remove();G.show();V=false;if(g.isAwake())g.setBgOpacity(b.bgOpacity,1,1);else{g.setBgOpacity(1,1,1);g.disableHandles()}ka(D,0,1)}},$=function(a,c){V&&(b.bgFade&&!c?N.animate({opacity:1-
a},{queue:false,duration:b.fadeTime}):N.css({opacity:1-a}))},Ta=function(){return N.children()},V=!1,N=c("<div />").css({position:"absolute",zIndex:240,opacity:0}),M={top:Z(),left:Z().height(l),right:Z().height(l),bottom:Z()};C={update:Qa,updateRaw:Pa,getShades:Ta,setBgColor:Ra,enable:Sa,disable:Ua,resize:function(a,b){M.left.css({height:m(b)});M.right.css({height:m(b)})},refresh:function(){b.shade?Sa():Ua();g.isAwake()&&$(b.bgOpacity)},opacity:$};var g,Va=function(a,b){var d=c("<div />").mousedown(va(a)).css({cursor:a+
"-resize",position:"absolute",zIndex:b}).addClass("ord-"+a);x.support&&d.bind("touchstart.jcrop",x.createDragger(a));J.append(d);return d},Xa=function(){var a=p.getFixed();p.setPressed([a.x,a.y]);p.setCurrent([a.x2,a.y2]);Wa()},Wa=function(a){if(O)return Ya(a)},Ya=function(a){var c=p.getFixed(),d=c.h;K.width(Math.round(c.w)).height(Math.round(d));var d=c.x,e=c.y;b.shade||G.css({top:m(-e),left:m(-d)});K.css({top:m(e),left:m(d)});b.shade&&C.updateRaw(c);if(!O){K.show();b.shade?C.opacity(Q):pa(Q,true);
O=true}a?b.onSelect.call(z,P(c)):b.onChange.call(z,P(c))},pa=function(a,c,d){if(O||c)b.bgFade&&!d?i.animate({opacity:a},{queue:false,duration:b.fadeTime}):i.css("opacity",a)},Za=function(){aa=true;if(b.allowResize){J.show();return true}},ba=function(){aa=false;J.hide()},$a=function(a){if(a){na=true;ba()}else{na=false;Za()}},O,ab=370,aa=!1;if(b.dragEdges&&c.isArray(b.createDragbars)){var bb=b.createDragbars,ca;for(ca=0;ca<bb.length;ca++)Va(bb[ca],ab++).addClass("jcrop-dragbar")}if(c.isArray(b.createHandles)){var cb=
b.createHandles,da;for(da=0;da<cb.length;da++){var qa=b.handleSize,kb=Va(cb[da],ab++).css({opacity:b.handleOpacity}).addClass(b.baseClass+"-handle");qa&&kb.width(qa).height(qa)}}if(b.drawBorders&&c.isArray(b.createBorders)){var db=b.createBorders,W,ea;for(ea=0;ea<db.length;ea++){switch(db[ea]){case "n":W="hline";break;case "s":W="hline bottom";break;case "e":W="vline right";break;case "w":W="vline"}var lb=W,mb=c("<div />").css({position:"absolute",opacity:b.borderOpacity}).addClass(b.baseClass+"-"+
lb);Y.append(mb)}}c(document).bind("touchstart.jcrop-ios",function(a){c(a.currentTarget).hasClass("jcrop-tracker")&&a.stopPropagation()});var ra=ya().mousedown(va("move")).css({cursor:"move",position:"absolute",zIndex:360});x.support&&ra.bind("touchstart.jcrop",x.createDragger("move"));Y.append(ra);ba();g={updateVisible:Wa,update:Ya,release:function(){ba();K.hide();b.shade?C.opacity(1):pa(1);O=false;b.onRelease.call(z)},refresh:Xa,isAwake:function(){return O},setCursor:function(a){ra.css("cursor",
a)},enableHandles:Za,enableOnly:function(){aa=true},showHandles:function(){aa&&J.show()},disableHandles:ba,animMode:$a,setBgOpacity:pa,done:function(){$a(false);Xa()}};var y,eb=function(a){fa(w(a));return false},ga=function(a){a.preventDefault();a.stopPropagation();if(I){I=false;sa(w(a));g.isAwake()&&b.onSelect.call(z,P(p.getFixed()));H.css({zIndex:290});c(document).unbind(".jcrop");fa=function(){};sa=function(){}}return false},nb=function(a){fa(w(x.cfilter(a)));return false},ob=function(a){return ga(x.cfilter(a))},
fa=function(){},sa=function(){},fb=b.trackDocument;fb||H.mousemove(eb).mouseup(ga).mouseout(ga);i.before(H);y={activateHandlers:function(a,b,d){I=true;fa=a;sa=b;H.css({zIndex:450});d?c(document).bind("touchmove.jcrop",nb).bind("touchend.jcrop",ob):fb&&c(document).bind("mousemove.jcrop",eb).bind("mouseup.jcrop",ga);return false},setCursor:function(a){H.css("cursor",a)}};var X,pb=function(){E.hide()},ha=function(a,c,d){if(b.allowMove){p.moveOffset([c,d]);g.updateVisible(true)}a.preventDefault();a.stopPropagation()},
qb=function(a){if(a.ctrlKey||a.metaKey)return true;var c=(jb=a.shiftKey?true:false)?10:1;switch(a.keyCode){case 37:ha(a,-c,0);break;case 39:ha(a,c,0);break;case 38:ha(a,0,-c);break;case 40:ha(a,0,c);break;case 27:b.allowSelect&&g.release();break;case 9:return true}return false},E=c('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),rb=c("<div />").css({position:"absolute",overflow:"hidden"}).append(E);b.keySupport&&(E.keydown(qb).blur(pb),Ga||!b.fixedSupport?
(E.css({position:"absolute",left:"-20px"}),rb.append(E).insertBefore(i)):E.insertBefore(i));X={watchKeys:function(){if(b.keySupport){E.show();E.focus()}}};x.support&&H.bind("touchstart.jcrop",x.newSelection);J.hide();ja(!0);var z={setImage:function(a,c){g.release();Ca();var d=new Image;d.onload=function(){var e=d.height,g=b.boxWidth,j=b.boxHeight;i.width(d.width).height(e);i.attr("src",a);G.attr("src",a);wa(i,g,j);n=i.width();l=i.height();G.width(n).height(l);H.width(n+L*2).height(l+L*2);D.width(n).height(l);
C.resize(n,l);Da();typeof c==="function"&&c.call(z)};d.src=a},animateTo:function(a,c){var d=a[0]/t,e=a[1]/v,i=a[2]/t,j=a[3]/v;if(!na){var f=p.flipCoords(d,e,i,j),l=p.getFixed(),h=[l.x,l.y,l.x2,l.y2],m=b.animationDelay,n=f[0]-h[0],q=f[1]-h[1],s=f[2]-h[2],u=f[3]-h[3],r=0,w=b.swingSpeed,d=h[0],e=h[1],i=h[2],j=h[3];g.animMode(true);var x=function(){r=r+(100-r)/w;h[0]=Math.round(d+r/100*n);h[1]=Math.round(e+r/100*q);h[2]=Math.round(i+r/100*s);h[3]=Math.round(j+r/100*u);r>=99.8&&(r=100);if(r<100){Ba(h);
window.setTimeout(x,m)}else{g.done();g.animMode(false);typeof c==="function"&&c.call(z)}};window.setTimeout(x,m)}},setSelect:Aa,setOptions:function(a){B(a);ja()},tellSelect:function(){return P(p.getFixed())},tellScaled:function(){return p.getFixed()},setClass:function(a){D.removeClass().addClass(b.baseClass+"-holder").addClass(a)},disable:Ca,enable:Da,cancel:function(){g.done();y.activateHandlers(null,null)},release:g.release,destroy:function(){D.remove();s.show();s.css("visibility","visible");c(u).removeData("Jcrop")},
focus:X.watchKeys,getBounds:function(){return[n*t,l*v]},getWidgetSize:function(){return[n,l]},getScaleFactor:function(){return[t,v]},getOptions:function(){return b},ui:{holder:D,selection:K}};za&&D.bind("selectstart",function(){return false});s.data("Jcrop",z);return z};c.fn.Jcrop=function(u,r){var m;this.each(function(){if(c(this).data("Jcrop")){if("api"===u)return c(this).data("Jcrop");c(this).data("Jcrop").setOptions(u)}else"IMG"==this.tagName?c.Jcrop.Loader(this,function(){c(this).css({display:"block",
visibility:"hidden"});m=c.Jcrop(this,u);c.isFunction(r)&&r.call(m)}):(c(this).css({display:"block",visibility:"hidden"}),m=c.Jcrop(this,u),c.isFunction(r)&&r.call(m))});return this};c.Jcrop.Loader=function(u,r,m){function A(){B.complete?(w.unbind(".jcloader"),c.isFunction(r)&&r.call(B)):window.setTimeout(A,50)}var w=c(u),B=w[0];w.bind("load.jcloader",A).bind("error.jcloader",function(){w.unbind(".jcloader");c.isFunction(m)&&m.call(B)});B.complete&&c.isFunction(r)&&(w.unbind(".jcloader"),r.call(B))};
c.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:0.6,bgFade:!1,borderOpacity:0.4,handleOpacity:0.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:"n s e w nw ne se sw".split(" "),createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,
0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
